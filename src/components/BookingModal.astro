---
---

<div id="bookingModalOverlay" class="hidden fixed inset-0 bg-gray-900/70 z-40"></div>

<div id="bookingModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl p-6 md:p-8 relative
            max-h-[80vh] overflow-y-auto">


    <h2 class="text-2xl font-extrabold text-center text-gray-900 mb-2">Book Your ConsultationÔ∏è</h2>
        <p class="text-center text-gray-500 mb-6 text-sm">Secure your preferred time slot with Dr. Aanchal Tyagi.</p>

        <form id="bookingForm" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Full Name *</label>
                <input id="b_name" required placeholder="Enter full name"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150" />
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Email *</label>
                <input id="b_email" required type="email"
                       placeholder="Enter email"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150" />
            </div>

            <div class="md:col-span-2">
                <label class="block text-sm font-semibold text-gray-700 mb-1">Phone *</label>
                <input id="b_phone" required placeholder="Enter phone number"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150" />
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Preferred Date *</label>
                <input id="b_date" type="date" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg appearance-none focus:ring-green-500 focus:border-green-500 transition duration-150" />
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Preferred Time *</label>
                <select id="b_time" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:ring-green-500 focus:border-green-500 transition duration-150">
                    <option value="">Select time</option>
                    <option>10:00 AM</option>
                    <option>11:00 AM</option>
                    <option>12:00 PM</option>
                    <option>04:00 PM</option>
                    <option>05:00 PM</option>
                    <option>06:00 PM</option>
                </select>
            </div>

            <div class="md:col-span-2">
                <label class="block text-sm font-semibold text-gray-700 mb-1">Message (optional)</label>
                <textarea id="b_message" rows="2"
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150"
                          placeholder="Describe your health concerns..."></textarea>
            </div>

            <div class="md:col-span-2 flex justify-between items-center pt-3">
                <span id="b_status" class="text-sm font-medium text-gray-600"></span>

                <div class="flex gap-3">
                    <button id="b_cancel" type="button"
                            class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-150 font-medium">
                        Cancel
                    </button>

                    <button id="b_submit"
                            class="px-8 py-2 rounded-lg bg-green-600 text-white font-semibold shadow-md hover:bg-green-700 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed">
                        Book Consultation
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    import { saveBooking } from "../services/firebaseService.js";

    const overlay = document.getElementById("bookingModalOverlay");
    const modal = document.getElementById("bookingModal");

    window.openBookingModal = () => {
        overlay.classList.remove("hidden");
        modal.classList.remove("hidden");
        document.body.style.overflow = "hidden";
    };

    window.closeBookingModal = () => {
        overlay.classList.add("hidden");
        modal.classList.add("hidden");
        document.body.style.overflow = "";
    };

    document.getElementById("bookingModalClose")?.addEventListener("click", window.closeBookingModal);
    document.getElementById("b_cancel")?.addEventListener("click", window.closeBookingModal);
    overlay?.addEventListener("click", window.closeBookingModal);

    const form = document.getElementById("bookingForm");
    const statusEl = document.getElementById("b_status");
    const submitBtn = document.getElementById("b_submit");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const data = {
            name: b_name.value,
            email: b_email.value,
            phone: b_phone.value,
            date: b_date.value,
            time: b_time.value,
            message: b_message.value,
            source: window.location.pathname,
        };

        submitBtn.disabled = true;
        statusEl.textContent = "Sending...";
        statusEl.classList.remove("text-green-600", "text-red-600");

        try {
            await saveBooking(data);

            statusEl.textContent = "Submitted successfully! üéâ";
            statusEl.classList.add("text-green-600");

            setTimeout(() => {
                window.closeBookingModal();
                statusEl.textContent = "";
                statusEl.classList.remove("text-green-600");
                form.reset();
            }, 1200);

        } catch (err) {
            console.error(err);
            statusEl.textContent = "Something went wrong!";
            statusEl.classList.add("text-red-600");
        }

        submitBtn.disabled = false;
    });

    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".book-appointment-btn")
            .forEach(btn => btn.addEventListener("click", (e) => {
                e.preventDefault();
                openBookingModal();
            }));
    });
</script>